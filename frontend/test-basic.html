<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Test</title>
</head>
<body>
    <h1>Basic Frontend Test</h1>
    <input type="text" id="test-input" placeholder="Enter test question" />
    <button id="test-button" onclick="sendTestQuery()">Send Test</button>
    <div id="test-result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>

    <script>
        async function sendTestQuery() {
            const input = document.getElementById('test-input');
            const resultDiv = document.getElementById('test-result');
            const query = input.value.trim();
            
            if (!query) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter a question</p>';
                return;
            }

            resultDiv.innerHTML = '<p>Sending query...</p>';
            
            try {
                const response = await fetch('/query/stream', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: query,
                        text_limit: 2,
                        audio_limit: 1,
                        event_limit: 1,
                        similarity_threshold: 0.3,
                        include_sources: true,
                        temperature: 0.7,
                        max_tokens: 200
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                resultDiv.innerHTML = '<p style="color: green;">✅ Query sent successfully! Check browser console for streaming data.</p>';
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    console.log('Received chunk:', chunk);
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`;
                console.error('Test query error:', error);
            }
        }
    </script>
</body>
</html>