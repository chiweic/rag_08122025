<!DOCTYPE html>\n<html>\n<head>\n    <title>RAG Chat Test</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        #chat { \n            border: 1px solid #ccc; \n            height: 400px; \n            overflow-y: scroll; \n            padding: 10px; \n            margin-bottom: 10px;\n            white-space: pre-wrap;\n        }\n        #input { width: 300px; padding: 8px; }\n        #send { padding: 8px 15px; margin: 5px; }\n        .user { color: blue; margin: 5px 0; }\n        .bot { color: green; margin: 5px 0; }\n        .streaming { color: green; margin: 5px 0; }\n    </style>\n</head>\n<body>\n    <h1>RAG Chat Test</h1>\n    <div id=\"chat\"></div>\n    <input type=\"text\" id=\"input\" placeholder=\"Type your question here\" value=\"禪修方法\">\n    <button id=\"send\">Send</button>\n    <button id=\"meditation\">禪修方法</button>\n    <button id=\"test\">Test Question</button>\n\n    <script>\n        const chat = document.getElementById('chat');\n        const input = document.getElementById('input');\n        const sendBtn = document.getElementById('send');\n        const meditationBtn = document.getElementById('meditation');\n        const testBtn = document.getElementById('test');\n\n        function addMessage(text, sender) {\n            const div = document.createElement('div');\n            div.className = sender;\n            div.textContent = sender + ': ' + text;\n            chat.appendChild(div);\n            chat.scrollTop = chat.scrollHeight;\n        }\n\n        async function sendMessage(question) {\n            addMessage(question, 'You');\n            input.value = '';\n            \n            try {\n                const response = await fetch('http://localhost:8000/query/stream', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ question })\n                });\n                \n                if (!response.ok) throw new Error('Network response was not ok');\n                \n                const reader = response.body.getReader();\n                const decoder = new TextDecoder();\n                \n                // Create a div for the streaming response\n                const streamingDiv = document.createElement('div');\n                streamingDiv.className = 'streaming';\n                streamingDiv.textContent = 'Bot: ';\n                chat.appendChild(streamingDiv);\n                \n                let accumulatedContent = '';\n                \n                while (true) {\n                    const { done, value } = await reader.read();\n                    if (done) break;\n                    \n                    // Decode the chunk\n                    const chunk = decoder.decode(value, { stream: true });\n                    \n                    // Process each line in the chunk\n                    const lines = chunk.split('\\n');\n                    \n                    for (const line of lines) {\n                        if (line.startsWith('data: ')) {\n                            const data = line.slice(6); // Remove 'data: ' prefix\n                            \n                            if (data === '[DONE]') {\n                                // Stream is complete\n                                break;\n                            }\n                            \n                            try {\n                                const parsedData = JSON.parse(data);\n                                \n                                // Handle answer chunks\n                                if (parsedData.type === 'answer') {\n                                    accumulatedContent += parsedData.content;\n                                    streamingDiv.textContent = 'Bot: ' + accumulatedContent;\n                                    chat.scrollTop = chat.scrollHeight;\n                                }\n                            } catch (parseError) {\n                                console.error('Error parsing JSON:', parseError);\n                            }\n                        }\n                    }\n                }\n            } catch (error) {\n                addMessage('Error: ' + error.message, 'Bot');\n            }\n        }\n\n        sendBtn.onclick = () => {\n            if (input.value.trim()) sendMessage(input.value.trim());\n        };\n\n        meditationBtn.onclick = () => {\n            sendMessage('禪修方法');\n        };\n\n        testBtn.onclick = () => {\n            sendMessage('What is the weather today?');\n        };\n\n        input.onkeypress = (e) => {\n            if (e.key === 'Enter' && input.value.trim()) {\n                sendMessage(input.value.trim());\n            }\n        };\n    </script>\n</body>\n</html>